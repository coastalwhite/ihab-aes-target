#include <string.h>
#include <stdint.h>
#include <stdlib.h>

#include "aes.h"

__attribute__ ((noinline)) int STOP_FN() {
	volatile int i = 0;
	return i;
}

int main(void) {
	uint8_t userKey[] = {
        0x2b, 0x7e, 0x15, 0x16, 0x28, 0xae, 0xd2, 0xa6,
        0xab, 0xf7, 0x15, 0x88, 0x09, 0xcf, 0x4f, 0x3c
    };
    uint8_t text[] = {
        'w', 'w', 'w', '.', 'b', 'r', 'o', 'b', 'w', 'i', 'n', 'd', '.', 'c', 'o', 'm'
    };
    uint8_t cipher[16];
    AES_KEY aes_key;

    memset(&aes_key, 0x00, sizeof(aes_key));

    AES_set_encrypt_key(userKey, 128, &aes_key);
    AES_encrypt_modified(text, cipher, &aes_key);

	// No fault:
	// cipher = {0xb6, 0x8, 0x4, 0xbc, 0x5f, 0x65, 0xf2, 0xb3, 0xd7, 0x16, 0xf7, 0x6f, 0xd6, 0x6a, 0xa2, 0x27}
	// Fault 1 at AES_encrypt+0x16:
	// cipher = {0x1c, 0xfe, 0x1, 0x20, 0xc, 0xfe, 0x1, 0x20, 0x28, 0x7, 0x0, 0x8, 0x0, 0x0, 0x0, 0x0}
	return STOP_FN();
}
